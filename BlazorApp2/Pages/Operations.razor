@page "/operations"
@using BlazorApp2.Services
@using ConsoleApp1.DAL.Entity
@inject IOperationServices OperationService
@inject IDialogService DialogService

<MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6">
    <MudTabPanel Text="Create">
        <MudForm @ref="_form" @bind-IsValid="@_success">
            <MudTextField T="DateTime" Label="Date of Operation" Required="true" RequiredError="Date of operations is requiered " @bind-Value="DateOfOperation"/>
            <MudTextField T="decimal" Label="Amount" Required="true" RequiredError="Amount of operations is requiered " @bind-Value="Amount"/>
            <MudTextField T="Guid" Label="Type Id" Required="true" RequiredError="Type of operations is requiered " @bind-Value="TypeId"/>
            <div class="d-flex align-center justify-space-between">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@CreateNewOperation" Class="ml-auto">Create</MudButton>
            </div>
        </MudForm>
    </MudTabPanel>
    <MudTabPanel Text="Update">
        <MudForm @ref="_form" @bind-IsValid="@_success">
            <MudTextField T="Guid" Label="ID of Operation" Required="true" RequiredError="ID of operations is requiered " @bind-Value="Id"/>
            <MudTextField T="DateTime" Label="Date of Operation" Required="true" RequiredError="Date of operations is requiered " @bind-Value="DateOfOperation"/>
            <MudTextField T="decimal" Label="Amount" Required="true" RequiredError="Amount of operations is requiered " @bind-Value="Amount"/>
            <MudTextField T="Guid" Label="Type Id" Required="true" RequiredError="Type of operations is requiered " @bind-Value="TypeId"/>
            <div class="d-flex align-center justify-space-between">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@UpdateOperation" Class="ml-auto">Update</MudButton>
            </div>
        </MudForm>
    </MudTabPanel>
    <MudTabPanel Text="Remove">
        <MudForm @ref="_form" @bind-IsValid="@_success">
            <MudTextField T="Guid" Label="Enter current Id" Required="true" RequiredError="Id is required!" @bind-Value="Id"/>
            <div class="d-flex align-center justify-space-between">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@RemoveOperation" Class="ml-auto">Remove</MudButton>
            </div>
        </MudForm>
    </MudTabPanel>
    <MudTabPanel Text="Get Opertaion">
        <MudForm @ref="_form" @bind-IsValid="@_success">
            <MudTextField T="Guid" Label="Id" Required="true" RequiredError="Id of operations is requiered " @bind-Value="Id"/>
            <div class="d-flex align-center justify-space-between">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@GetNeededOperation" Class="ml-auto">Search</MudButton>
                <MudContainer>
                    <MudPaper>
                        <div>
                            <h3>Person Details</h3>
                            @if (_showDetails)
                            {
                                <p>Id: @CurrentOperation.Id</p>
                                <p>TypeId: @CurrentOperation.TypeId</p>
                                <p>Amount: @CurrentOperation.Amount</p>
                                <p>DateTime: @CurrentOperation.DateOfOperations</p>
                            }
                        </div>
                    </MudPaper>
                </MudContainer>
            </div>
        </MudForm>
    </MudTabPanel>
</MudTabs>


@code {
    
    MudForm _form;
    bool _success;
    private DateTime DateOfOperation { get; set; }
    private decimal Amount { get; set; }
    private Guid Id { get; set; }
    private Guid TypeId { get; set; }
    private Operation CurrentOperation { get; set; }
    private List<Operation>? _allOperations;
    private string _state = "Something wrong";
    private bool _showDetails;

    public async Task CreateNewOperation()
    {
        var result = await OperationService.CreateNewOperation(TypeId, DateOfOperation, Amount);
        if (result is true)
        {
            await DialogService.ShowMessageBox("Result", "Element is Added");
        }
        else
        {
            await DialogService.ShowMessageBox("Result", "Element is present or Error");
        }
    }

    public async Task UpdateOperation()
    {
        var result = await OperationService.UpdateOperation(Id, TypeId, DateOfOperation, Amount);
        if (result is true)
        {
            await DialogService.ShowMessageBox("Result", "Element is Updated");
        }
        else
        {
            await DialogService.ShowMessageBox("Result", "Element is wrong or Error");
        }
    }

    public async Task RemoveOperation()
    {
        var result = await OperationService.RemoveOperation(Id);
        if (result is true)
        {
            await DialogService.ShowMessageBox("Result", "Element is Removed");
        }
        else
        {
            await DialogService.ShowMessageBox("Result", "Element is wrong or has Operations(Please remove Operations than remove type)");
        }
    }

    public async Task GetNeededOperation()
    {
        CurrentOperation = await OperationService.GetSomeOperation(Id);
        if (CurrentOperation != null)
        {
            Id = CurrentOperation.Id;
            TypeId = CurrentOperation.TypeId;
            Amount = CurrentOperation.Amount;
            DateOfOperation = CurrentOperation.DateOfOperations;
            _showDetails = true;
        }
        else
        {
            await DialogService.ShowMessageBox("Result", "Element is wrong or has Operations(Please remove Operations than remove type)");
        }
    }
}